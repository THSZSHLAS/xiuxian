<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿®ä»™æ™ºåŠ›å¤§é˜µï¼šæ¸¡åŠ«é£å‡ V3.0</title>
    <style>
        :root {
            --primary-color: #00e5ff;
            --danger-color: #ff3333;
            --bg-color: #0a0a12;
            --card-bg: #1a1a24;
            --text-color: #e0e0e0;
            --gold: #ffd700;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #1b1b2f 0%, #000000 100%);
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            width: 90%;
            max-width: 600px;
            background: var(--card-bg);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            z-index: 10;
            transition: all 0.3s ease;
        }

        h1 {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--primary-color);
            color: var(--primary-color);
        }

        .level-tag {
            display: inline-block;
            background: #333;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            color: var(--gold);
            margin-bottom: 10px;
            border: 1px solid var(--gold);
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 12px 0;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--primary-color);
            color: var(--text-color);
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            position: relative;
            transition: transform 0.1s, background 0.2s;
        }

        .btn:active {
            transform: scale(0.98);
            background: rgba(0, 229, 255, 0.2);
        }

        .start-btn {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            color: white;
            border: none;
            text-align: center;
            font-weight: bold;
            font-size: 1.3em;
            margin-top: 30px;
        }

        /* è¡€æ¡æ ·å¼ */
        .health-wrapper {
            position: relative;
            margin: 20px 0;
        }
        .health-container {
            width: 100%;
            background: #333;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 0 5px #000;
        }
        .health-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff3333, #ff9933);
            width: 100%;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .hp-value {
            position: absolute;
            top: -22px;
            right: 0;
            color: var(--danger-color);
            font-weight: bold;
            font-size: 0.9em;
        }

        .hidden { display: none; }

        /* ç‰¹æ•ˆå±‚ */
        #lightning-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; pointer-events: none; z-index: 999;
        }

        .shake { animation: shake 0.4s; }
        .flash { animation: flash 0.3s 2; }

        @keyframes shake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-5px, 0); }
            50% { transform: translate(5px, 0); }
            75% { transform: translate(-5px, 0); }
            100% { transform: translate(0, 0); }
        }
        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 0.9; }
            100% { opacity: 0; }
        }

        .result-rank {
            font-size: 2.5em;
            color: var(--gold);
            text-shadow: 0 0 20px var(--gold);
            margin: 20px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="lightning-overlay"></div>

    <div id="start-screen" class="container">
        <h1>ğŸ—¡ï¸ æ¸¡åŠ«é£å‡ V3.0</h1>
        <p>
            å¤©é“æ— æƒ…ï¼Œä¹å¤©é›·åŠ«å·²è‡³ã€‚<br>
            æœ¬æ¬¡é›·åŠ«å…± <b>15é“</b>ï¼Œæ¶µç›–ä¸‡ç•ŒçŸ¥è¯†ï¼š<br>
            <span style="font-size:0.9em; color:#888; display:block; margin-top:10px; text-align:left; padding-left:20px;">
            â€¢ 1é“ ç­‘åŸº (å°å­¦å¸¸è¯†) <br>
            â€¢ 2é“ é‡‘ä¸¹ (åˆä¸­åŸºç¡€) <br>
            â€¢ 4é“ å…ƒå©´ (é«˜ä¸­è¿›é˜¶) <br>
            â€¢ 5é“ åŒ–ç¥ (ç ”ç©¶ç”Ÿé€»è¾‘) <br>
            â€¢ 3é“ åˆé“ (åšå£«ç»ˆææ‚–è®º)
            </span>
            <br>
            <span style="color: var(--danger-color); font-weight:bold;">âš ï¸ é“å¿ƒ(è¡€æ¡)ç ´ç¢ 3 æ¬¡å³åˆ»é™¨è½ï¼</span>
        </p>
        <button class="btn start-btn" onclick="startGame()">å¾æ¬²é€†å¤©æ”¹å‘½ (å¼€å§‹)</button>
    </div>

    <div id="game-screen" class="container hidden">
        <div style="display:flex; justify-content:space-between; font-size:0.9em; color:#888;">
            <span id="question-progress">ç¬¬ 1/15 åŠ«</span>
            <span style="color: var(--gold)">ä¿®ä¸º: <span id="score">0</span> å¹´</span>
        </div>
        
        <div class="health-wrapper">
            <div class="hp-value">é“å¿ƒ: <span id="hp-text">3</span>/3</div>
            <div class="health-container">
                <div id="health-bar" class="health-bar"></div>
            </div>
        </div>

        <div id="question-area">
            <div id="level-badge" class="level-tag">ç­‘åŸºæœŸé›·åŠ«</div>
            <h2 id="question-text" style="margin-top:0">é¢˜ç›®åŠ è½½ä¸­...</h2>
            <div id="options-container"></div>
        </div>
    </div>

    <div id="success-screen" class="container hidden">
        <h1>ğŸŒ©ï¸ æ¸¡åŠ«æˆåŠŸï¼</h1>
        <p>å¤©é—¨å¤§å¼€ï¼Œä»™ä¹é˜µé˜µ...</p>
        <div class="result-rank" id="final-rank"></div>
        <p id="final-comment"></p>
        <button class="btn start-btn" onclick="location.reload()">è½¬ä¸–é‡ä¿® (å†æ¥ä¸€æ¬¡)</button>
    </div>

    <div id="fail-screen" class="container hidden">
        <h1 style="color:red">âš¡ é™¨ è½ âš¡</h1>
        <div class="result-rank" style="color:gray">èº«æ­»é“æ¶ˆ</div>
        <p>å¾ˆé—æ†¾ï¼Œä½ åœ¨ç¬¬ <span id="death-level"></span> é‡é›·åŠ«åŒ–ä¸ºäº†ç°çƒ¬ã€‚</p>
        <p>ä¸‹è¾ˆå­å¤šè¯»ç‚¹ä¹¦å§...</p>
        <button class="btn" style="border-color:red; color:red; margin-top:20px;" onclick="location.reload()">é‡æ–°æŠ•èƒ</button>
    </div>

    <script src="questions.js"></script>

    <script>
        // æ¸¸æˆé…ç½®
        let gameQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let hp = 3;
        const maxHp = 3;
        
        // éš¾åº¦é…ç½®ï¼šè°ƒæ•´ä¸º 15 é¢˜é…ç½®
        const CONFIG = {
            elem: 1,
            middle: 2,
            high: 4,
            master: 5,
            phd: 3
        };

        // æ´—ç‰Œç®—æ³•
        function shuffle(array) {
            let arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // æ ¸å¿ƒï¼šç”Ÿæˆæœ¬æ¬¡æ¸¸æˆçš„é¢˜ç›®åˆ—è¡¨
        function generateGameLevel() {
            if (typeof questionDatabase === 'undefined') {
                alert("é¢˜ç›®æ•°æ®åŠ è½½å¤±è´¥ï¼è¯·ç¡®ä¿ questions.js æ–‡ä»¶å­˜åœ¨ã€‚");
                return [];
            }

            // æŒ‰æ ‡ç­¾åˆ†ç±»
            const pools = {
                elem: questionDatabase.filter(q => q.tag === 'elem'),
                middle: questionDatabase.filter(q => q.tag === 'middle'),
                high: questionDatabase.filter(q => q.tag === 'high'),
                master: questionDatabase.filter(q => q.tag === 'master'),
                phd: questionDatabase.filter(q => q.tag === 'phd')
            };

            // æŠ½å–é¢˜ç›® (å¦‚æœé¢˜åº“ä¸å¤Ÿï¼Œä¼šæŠŠæ‰€æœ‰è¯¥ç±»åˆ«çš„é¢˜ç›®éƒ½æ‹¿å‡ºæ¥)
            let selected = [];
            selected = selected.concat(shuffle(pools.elem).slice(0, CONFIG.elem));
            selected = selected.concat(shuffle(pools.middle).slice(0, CONFIG.middle));
            selected = selected.concat(shuffle(pools.high).slice(0, CONFIG.high));
            selected = selected.concat(shuffle(pools.master).slice(0, CONFIG.master));
            selected = selected.concat(shuffle(pools.phd).slice(0, CONFIG.phd));

            return selected;
        }

        function startGame() {
            gameQuestions = generateGameLevel();
            if (gameQuestions.length === 0) {
                alert("é¢˜åº“æ•°é‡ä¸è¶³ä»¥ç”Ÿæˆå…³å¡ï¼Œè¯·æ£€æŸ¥ questions.js");
                return;
            }

            score = 0;
            hp = maxHp;
            currentIndex = 0;
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            updateStats();
            showQuestion();
        }

        function getLevelName(tag) {
            const map = {
                'elem': 'ç­‘åŸºæœŸ (å°å­¦)',
                'middle': 'é‡‘ä¸¹æœŸ (åˆä¸­)',
                'high': 'å…ƒå©´æœŸ (é«˜ä¸­)',
                'master': 'åŒ–ç¥æœŸ (ç ”ç©¶ç”Ÿ)',
                'phd': 'åˆé“æœŸ (åšå£«)'
            };
            return map[tag] || 'æœªçŸ¥é›·åŠ«';
        }

        function showQuestion() {
            const qData = gameQuestions[currentIndex];
            
            // åŠ¨ç”»è¿‡æ¸¡
            const qArea = document.getElementById('question-area');
            qArea.style.opacity = 0;
            
            setTimeout(() => {
                document.getElementById('level-badge').innerText = getLevelName(qData.tag);
                document.getElementById('question-text').innerText = qData.q;
                const optsContainer = document.getElementById('options-container');
                optsContainer.innerHTML = '';

                // å¤„ç†é€‰é¡¹
                let answers = qData.a.map((text, index) => ({
                    text: text,
                    isCorrect: index === qData.correct
                }));
                answers = shuffle(answers);

                answers.forEach(ans => {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.innerText = ans.text;
                    btn.onclick = () => handleAnswer(ans.isCorrect);
                    optsContainer.appendChild(btn);
                });

                document.getElementById('question-progress').innerText = `ç¬¬ ${currentIndex + 1}/15 åŠ«`;
                qArea.style.opacity = 1;
            }, 200);
        }

        function handleAnswer(isCorrect) {
            if (isCorrect) {
                score++;
                nextLevel();
            } else {
                hp--;
                updateStats();
                triggerDamage();
                
                if (hp <= 0) {
                    die();
                } else {
                    nextLevel();
                }
            }
        }

        function nextLevel() {
            currentIndex++;
            if (currentIndex < gameQuestions.length) {
                showQuestion();
            } else {
                finishGame();
            }
        }

        function updateStats() {
            document.getElementById('score').innerText = score * 100; 
            document.getElementById('hp-text').innerText = hp;
            const hpBar = document.getElementById('health-bar');
            hpBar.style.width = (hp / maxHp * 100) + '%';
            
            if (hp <= 2) hpBar.style.background = '#ff3333';
        }

        function triggerDamage() {
            const container = document.querySelector('.container');
            container.classList.add('shake');
            document.body.style.backgroundColor = '#500';
            setTimeout(() => {
                container.classList.remove('shake');
                document.body.style.backgroundColor = ''; 
            }, 300);
        }

        function die() {
            const overlay = document.getElementById('lightning-overlay');
            overlay.classList.add('flash');
            setTimeout(() => {
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('fail-screen').classList.remove('hidden');
                document.getElementById('death-level').innerText = currentIndex + 1;
                overlay.classList.remove('flash');
            }, 500);
        }

        function finishGame() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('success-screen').classList.remove('hidden');
            
            const rankEl = document.getElementById('final-rank');
            const commentEl = document.getElementById('final-comment');
            
            // è¯„åˆ†é€»è¾‘ (æ€»åˆ†15åˆ†)
           // è¯„åˆ†é€»è¾‘
            let rank = "";
            let comment = "";
            
            if (score <= 3) {
                rank = "å¤–é—¨å¼Ÿå­ï¼Œå ªå ªç­‘åŸºç½¢äº†ï¼Œæ— åå°å’";
                comment = "ä½ è¿™æ™ºå•†ï¼Œè¿å±±é—¨éƒ½è¿›ä¸å»... <br>(ä¿®ä¸ºå¤ªä½)";
            } else if (score <= 5) {
                rank = "å†…é—¨å¼Ÿå­ï¼Œä¾¥å¹¸ä¿®æˆé‡‘ä¸¹ï¼Œè¿˜å…¥ä¸äº†é‚£ä½çš„æ³•çœ¼";
                comment = "è™½ç„¶æ´»ä¸‹æ¥äº†ï¼Œä½†ä¹Ÿåªæ˜¯ä¸ªæ™®é€šçš„ä¿®ä»™è€…ã€‚<br>(å‹‰å¼ºåŠæ ¼)";
            } else if (score <= 7) {
                rank = "å®—é—¨é•¿è€ï¼Œå€’æ˜¯æ„å¤–ä¹‹å–œï¼Œå…ƒå©´å·²æˆ";
                comment = "ä½ çš„æ™ºæ…§å·²è¶…è¶Šå‡¡äººï¼Œè¶³ä»¥å¼€å›è®²é“ï¼";
            } else if (score <= 11) {
                rank = "æ¸¡åŠ«è€ç¥–ï¼Œå¤ªææ€–äº†ï¼Œè‹¥éç»ä»£å¤©éª„æ–­ä¸å¯èƒ½è¾¾åˆ°å¦‚æ­¤å¢ƒç•Œï¼ŒåŒ–ç¥ï¼ï¼ï¼";
                comment = "ææ€–å¦‚æ–¯ï¼æ­¤ç•Œå·²æ— äººæ˜¯ä½ å¯¹æ‰‹ï¼";
            } else {
                rank = "ä¹å¤©ä»™å¸ï¼Œæˆ‘å·²æ— æ³•è¯„ä»·ï¼Œåˆé“å¢ƒï¼Œå½“ä¸–æ— æ•Œï¼";
                comment = "å…¨å¯¹ï¼Ÿï¼æˆ‘çœ‹ä½ ä¸æ˜¯äººï¼Œæ˜¯ç¥ï¼<br>å—å°å¼Ÿä¸€æ‹œï¼";
            }
            
            rankEl.innerText = rank;
            commentEl.innerHTML = comment;
        }
    </script>
</body>
</html>
